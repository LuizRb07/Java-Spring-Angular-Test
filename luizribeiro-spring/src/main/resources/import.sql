CREATE VIEW vwCandidato AS SELECT *, TIMESTAMPDIFF(year, data_nasc, now()) as idade, round(peso/(altura*altura), 2) as imc FROM tb_candidato ORDER BY nome;
CREATE VIEW vwCandidato_group_faixa_etaria AS SELECT case when idade between 0 and 10 then 'de 00 a 10 anos' when idade between 11 and 20 then 'de 11 a 20 anos' when idade between 21 and 30 then 'de 21 a 30 anos' when idade between 31 and 40 then 'de 31 a 40 anos' when idade between 41 and 50 then 'de 41 a 50 anos' when idade between 51 and 60 then 'de 51 a 60 anos' when idade between 61 and 70 then 'de 61 a 70 anos' when idade between 71 and 80 then 'de 71 a 80 anos' when idade between 81 and 90 then 'de 81 a 90 anos' when idade between 91 and 100 then 'de 91 a 100 anos' else 'mais de 100 anos' end as faixa_etaria, count(*) as candidatos, round(avg(imc),2) as media_imc FROM vwCandidato GROUP BY faixa_etaria ORDER BY faixa_etaria;
CREATE VIEW vwCandidato_group_estado AS SELECT estado, count(*) as candidatos FROM vwCandidato GROUP BY estado ORDER BY candidatos DESC;
CREATE VIEW vwCandidato_group_tipo_sanguineo AS SELECT tipo_sanguineo, count(*) as candidatos, round(avg(idade)) as media_idade  FROM vwCandidato GROUP BY tipo_sanguineo ORDER BY media_idade DESC;
CREATE VIEW vwCandidato_group_genero AS SELECT sexo, @t := count(*) as candidatos, @o := sum(imc>30) as obesidade, @o*100/@t as obesidade_perc FROM vwCandidato GROUP BY sexo ORDER BY obesidade_perc DESC;
CREATE VIEW vwCandidato_group_receptor AS SELECT tipo_sanguineo, count(*) as candidatos, CASE WHEN tipo_sanguineo ='A+' THEN (SELECT count(*) FROM vwcandidato WHERE idade between 16 and 69 AND peso > 50 AND tipo_sanguineo='A+' or tipo_sanguineo='A-' or tipo_sanguineo='O+' or tipo_sanguineo='O-') WHEN tipo_sanguineo ='A-' THEN (SELECT count(*) FROM vwcandidato WHERE idade between 16 and 69 AND peso > 50 AND tipo_sanguineo='A-' or tipo_sanguineo='O-') WHEN tipo_sanguineo ='B+' THEN (SELECT count(*) FROM vwcandidato WHERE idade between 16 and 69 AND peso > 50 AND tipo_sanguineo='B+' or tipo_sanguineo='B-' or tipo_sanguineo='O+' or tipo_sanguineo='O-') WHEN tipo_sanguineo ='B-' THEN (SELECT count(*) FROM vwcandidato WHERE idade between 16 and 69 AND peso > 50 AND tipo_sanguineo='B-' or tipo_sanguineo='O-') WHEN tipo_sanguineo ='AB+' THEN (SELECT count(*) FROM vwcandidato WHERE idade between 16 and 69 AND peso > 50) WHEN tipo_sanguineo ='AB-' THEN (SELECT count(*) FROM vwcandidato WHERE idade between 16 and 69 AND peso > 50 AND tipo_sanguineo='AB-' or tipo_sanguineo='A-' or tipo_sanguineo='B-' or tipo_sanguineo='O-') WHEN tipo_sanguineo ='O+' THEN (SELECT count(*) FROM vwcandidato WHERE idade between 16 and 69 AND peso > 50 AND tipo_sanguineo='O+' or tipo_sanguineo='O-') WHEN tipo_sanguineo ='O-' THEN (SELECT count(*) FROM vwcandidato WHERE idade between 16 and 69 AND peso > 50 AND tipo_sanguineo='O-') END as doadores FROM vwcandidato GROUP BY tipo_sanguineo ORDER BY doadores DESC;